{"type":"_aim","source":"mcp-knowledge-graph"}
{"type":"entity","name":"AgenticPipelineIngestor","entityType":"project","observations":["Enterprise-grade document processing pipeline with AI-driven decision making for content routing","Python 3.11+, FastAPI 0.104+, Pydantic 2.5+, PostgreSQL 15+, Redis 7+, SQLAlchemy 2.0+","Follows Spec-Driven Development (SDD) and API-First architecture","Status: Phase 4 Complete (Enterprise Features) as of 2026-02-16","83 Python source files, 20 test files, 1309-line spec document","Target: 20GB/day throughput, 10% near-realtime + 90% batch processing","Uses litellm for LLM abstraction (Azure OpenAI primary, OpenRouter fallback)","Build system: hatchling, linting: ruff (line-length=100, double quotes), type checking: mypy strict mode","Testing: pytest with asyncio_mode=auto, schemathesis for contract tests, hypothesis for property-based","Docker + docker-compose for local dev, AKS for Azure production deployment"]}
{"type":"entity","observations":["7-stage pipeline: Ingest -> Detect -> Parse -> Enrich -> Quality -> Transform -> Output","PipelineExecutor (src/core/pipeline.py) manages stage execution with PipelineContext for data sharing","PipelineStage ABC with name property, execute() method, on_success()/on_failure() hooks","IngestStage: file validation, staging to /tmp/pipeline/staging/{job_id}, SHA-256 hash","DetectStage: uses ContentDetector for PDF analysis (text ratio, image ratio, font info)","ParseStage: primary/fallback parser with AgenticDecisionEngine for intelligent selection","EnrichStage: LLM-powered entity extraction and document classification","QualityStage: QualityAssessor with configurable thresholds, auto-retry recommendations","TransformStage: fixed-size and semantic chunking strategies, embedding generation placeholder","OutputStage: routes to configured destinations via PluginRegistry","Pipeline uses OpenTelemetry spans per stage and Prometheus metrics for timing"],"name":"7StagePipeline","entityType":"architecture"}
{"type":"entity","observations":["Located at src/core/engine.py - main job lifecycle manager","OrchestrationEngine class with plugin_registry, llm_provider, dlq, router dependencies","In-memory job store (_active_jobs dict[UUID, Job]) - no DB persistence yet","Key methods: create_job(), process_job(), retry_job(), cancel_job(), move_job_to_dlq()","Global singleton pattern via get_engine()/set_engine() functions","Retry logic integrates with RetryStrategyType and RetryContext from src/core/retry.py","process_job() creates PipelineExecutor and delegates to executor.execute()"],"name":"OrchestrationEngine","entityType":"component"}
{"type":"entity","entityType":"component","observations":["Located at src/core/decisions.py - LLM-powered decision engine","AgenticDecisionEngine: base class with select_parser(), decide_retry(), analyze_error()","AdvancedDecisionEngine: extends with ML-based decisions, historical data, adaptive thresholds","Parser selection uses LLM with JSON response format, falls back to rule-based decisions","Rule-based fallback: SCANNED_PDF->azure_ocr, IMAGE->azure_ocr, MIXED_PDF->docling+fallback, TEXT->docling","Retry decision based on quality score: <0.3->fallback_parser, 0.3-0.5->depends, >0.5->no retry","Key dataclasses: ParserSelection, RetryDecision, DecisionContext, DecisionResult","optimize_quality_thresholds() suggests thresholds based on historical QualityScore data"],"name":"AgenticDecisionEngine"}
{"type":"entity","name":"PluginSystem","entityType":"architecture","observations":["Base classes in src/plugins/base.py: BasePlugin, SourcePlugin, ParserPlugin, DestinationPlugin","Key data classes: PluginMetadata, Connection, SourceFile, RetrievedFile, ParsingResult, TransformedData, WriteResult","Protocols: StreamingSource, AsyncParser, BatchDestination for optional capabilities","PluginRegistry (src/plugins/registry.py): central registry with register/get/list methods","PluginLoader (src/plugins/loaders.py): auto-discovery from entry points and modules","Source plugins: S3Source, AzureBlobSource, SharePointSource","Parser plugins: DoclingParser, AzureOCRParser, CSVParser, JSONParser, XMLParser, EmailParser","Destination plugins: CogneeDestination, GraphRAGDestination, Neo4jDestination, PineconeDestination, WeaviateDestination","SourcePlugin has authorize() method for source-level authorization (S3 IAM, SharePoint permissions)"]}
{"type":"entity","name":"LLMProvider","entityType":"component","observations":["Located at src/llm/provider.py - litellm-based multi-provider LLM abstraction","LLMProvider class: initializes litellm Router with model list from config","Fallback chain: Azure GPT-4 -> OpenRouter Claude-3 -> Azure GPT-3.5","Methods: chat_completion(), simple_completion(), json_completion(), health_check()","ChatMessage dataclass with system/user/assistant factory methods","ChatCompletionResponse dataclass with from_litellm() class method","Full OpenTelemetry tracing with gen_ai.* span attributes per OpenTelemetry semantic conventions","Prometheus metrics recording for LLM requests (model, operation, status, latency, tokens)","Configuration via config/llm.yaml with env var resolution, loaded by LLMConfig in src/llm/config.py","Model groups: 'agentic-decisions' (GPT-4), 'enrichment' (GPT-3.5), 'classification'"]}
{"type":"entity","name":"AuthSystem","entityType":"component","observations":["Located at src/auth/ - comprehensive auth framework added in Phase 4","Multiple auth methods: API Key (api_key.py), JWT (jwt.py), OAuth2/OIDC (oauth2.py), Azure AD (azure_ad.py)","RBAC system (rbac.py): admin (all), operator (READ/CREATE/CANCEL/RETRY), developer (READ/CREATE_JOBS), viewer (READ)","FastAPI dependencies in src/auth/dependencies.py for route protection","Auth routes at /api/v1/auth/: login, token/refresh, me, logout, oauth2/authorize, oauth2/callback, api-keys CRUD","JWT token creation, validation, refresh via JWTHandler","API key generation with SHA-256 hashing via APIKeyAuth"]}
{"type":"entity","name":"AuditAndLineage","entityType":"component","observations":["Audit logging: src/audit/ with AuditEvent models and AuditLogger","Event types: JOB_CREATED/STARTED/COMPLETED/FAILED, AUTH_LOGIN/FAILED, API_KEY_CREATED/REVOKED, etc.","InMemoryAuditStore for dev, with Protocol-based storage backend pattern","Export capabilities: JSON, CSV, NDJSON formats","Data lineage: src/lineage/ with DataLineageTracker and InMemoryLineageStore","Tracks transformations through all 7 pipeline stages with input/output SHA-256 hashes","LineageGraph representation for visualization","Data retention: src/retention/manager.py with configurable policies (raw 30d, processed 90d, metadata 7yr, audit 7yr)","Audit routes at /api/v1/audit/: logs, export, summary, events/types","Lineage routes at /api/v1/lineage/{job_id}: graph, summary, verify, stages"]}
{"type":"entity","name":"Observability","entityType":"component","observations":["OpenTelemetry distributed tracing: src/observability/tracing.py with get_tracer(), start_pipeline_stage_span()","GenAI-specific spans: src/observability/genai_spans.py following OpenTelemetry semantic conventions","Prometheus metrics: src/observability/metrics.py with MetricsManager class","Metrics: ingestion_jobs_created_total, ingestion_jobs_completed_total, ingestion_job_duration_seconds, etc.","Structured logging: src/observability/logging.py using structlog","Middleware: src/observability/middleware.py for request/response instrumentation","Configuration: OTEL_ env prefix, config/otel-collector-config.yaml, config/prometheus.yml"]}
{"type":"entity","entityType":"component","observations":["Located at src/config.py - Pydantic Settings-based configuration","Main Settings class with nested sub-settings: database, redis, opensearch, azure, security, processing, observability, llm_yaml","Env var support with nested delimiter (__), .env file loading","DatabaseSettings: PostgreSQL async with pool config","SecuritySettings: JWT secret, algorithm, API key header, rate limiting, CORS","ProcessingSettings: max file size (100MB), max pages (1000), allowed MIME types, retry config","ObservabilitySettings: OTEL endpoint, Prometheus port, log level/format","Global settings instance via @lru_cache get_settings()"],"name":"ConfigSettings"}
{"type":"entity","observations":["Located at src/db/models.py - SQLAlchemy 2.0 models with type annotations","Tables: Job, JobDestination, PipelineConfig, SourceConfig, DestinationConfig, DataLineage, AuditLog","Phase 4 additions: User table (role, auth_provider, is_active, profile fields) and APIKey table (key_hash, permissions, rate_limit)","Async PostgreSQL support via asyncpg","Alembic-ready for migrations (but migrations not yet created)"],"name":"DBModels","entityType":"component"}
{"type":"entity","name":"APILayer","entityType":"component","observations":["OpenAPI 3.1 spec at api/openapi.yaml (850+ lines, 28 endpoints)","FastAPI app entry at src/main.py","Pydantic models at src/api/models.py (50+ models including Job, JobCreateRequest, PipelineConfig, ContentDetectionResult, etc.)","Route handlers: src/api/routes/ with health.py, auth.py, audit.py, lineage.py, dlq.py, bulk.py","Dependencies at src/api/dependencies.py for DI","Key endpoints: POST /api/v1/jobs, GET /api/v1/jobs/{id}, POST /api/v1/upload, GET /health","SSE events at /api/v1/jobs/{id}/events for real-time job tracking","SDK generation via sdks/generate.py for Python and TypeScript"]}
{"type":"entity","name":"CoreAdditionalModules","entityType":"component","observations":["src/core/retry.py: RetryContext, RetryStrategyType enum, RetryStrategy implementations, get_retry_registry()","src/core/dlq.py: DeadLetterQueue for failed jobs with enqueue/dequeue/reprocess, get_dlq()","src/core/routing.py: DestinationRouter for multi-destination output routing, get_router()","src/core/healing.py: Self-healing mechanisms with exponential backoff and jitter","src/core/learning.py: Learning feedback loop for processing optimization","src/core/optimizations.py: Performance optimizations","src/core/detection.py: ContentDetector with PDFAnalyzer and ImageAnalyzer","src/core/quality.py: QualityAssessor, TextQualityAnalyzer, StructureQualityAnalyzer, QualityScore","src/core/entity_extraction.py: Entity extraction module","src/core/webhooks.py: Webhook handling with HMAC signatures","src/core/enrichment/advanced.py: Advanced enrichment module","src/core/graphrag/: Knowledge graph and community detection"]}
{"type":"entity","name":"TestSuite","entityType":"component","observations":["20 test files across unit, integration, contract, and e2e categories","Unit tests: test_config.py, test_plugins.py, test_llm.py in tests/unit/","Integration tests: test_api.py in tests/integration/","Contract tests: test_openapi.py using Schemathesis in tests/contract/","E2E tests: test_full_pipeline.py, test_auth_flow.py, test_retry_mechanisms.py, test_dlq_workflow.py, test_performance.py","Pipeline integration test: tests/test_pipeline_integration.py","Test markers: unit, integration, contract, e2e, performance, slow, auth, retry, dlq","Coverage: minimum 1% configured (target 80%), addopts excludes e2e and performance by default","pytest-asyncio for async test support, factory-boy and faker for test data"]}
{"type":"entity","observations":["src/worker/main.py: WorkerService for background job processing","src/worker/processor.py: JobProcessor for processing jobs from queue with retry logic","Poll-based job processing with concurrent execution (configurable)","Plugin lifecycle management and graceful shutdown via signal handling","Support for single-job execution mode"],"name":"WorkerSystem","entityType":"component"}
{"type":"entity","observations":["docker/Dockerfile: Multi-stage build, Python 3.11 slim, non-root user, health check","docker/docker-compose.yml: Services: api, worker, PostgreSQL, Redis, OpenSearch, optional litellm proxy","azure/aks-deployment.yaml: K8s deployment for AKS with 3 API replicas, 5-10 workers","config/llm.yaml: LLM provider configuration with model groups and fallback chains","config/prometheus.yml: Prometheus scraping configuration","config/otel-collector-config.yaml: OpenTelemetry Collector configuration","Makefile: Build targets for common operations"],"name":"DeploymentConfig","entityType":"component"}
{"type":"entity","observations":["Phase 1 DONE: Foundation - OpenAPI spec, FastAPI scaffolding, plugin ABCs, LLM abstraction, DB models, Docker, contract tests, SDK gen","Phase 2 DONE: Core Pipeline - 7 pipeline stages, content detection, Docling+Azure OCR parsers, Cognee destination, agentic decisions, quality assessment, worker","Phase 3 DONE (implied): Agentic Features - decision engine, retry strategies, DLQ, multi-destination routing, S3/Azure Blob sources","Phase 4 DONE: Enterprise - OAuth2, RBAC, audit logging, data lineage, SharePoint, data retention","Phase 5 PENDING: Observability & Scale - OpenTelemetry enhancement, Azure deploy, performance optimization, 20GB/day","Phase 6 PENDING: Advanced Features - additional parsers, more destinations, entity extraction, bulk operations","Known gaps: DB migrations not created, in-memory storage for audit/lineage (needs PostgreSQL/OpenSearch backends), no token blacklist"],"name":"ImplementationPhases","entityType":"concept"}
{"type":"relation","to":"7StagePipeline","relationType":"contains","from":"AgenticPipelineIngestor"}
{"type":"relation","relationType":"contains","from":"AgenticPipelineIngestor","to":"PluginSystem"}
{"type":"relation","relationType":"contains","from":"AgenticPipelineIngestor","to":"OrchestrationEngine"}
{"type":"relation","relationType":"contains","from":"AgenticPipelineIngestor","to":"AgenticDecisionEngine"}
{"type":"relation","from":"AgenticPipelineIngestor","to":"LLMProvider","relationType":"contains"}
{"type":"relation","relationType":"contains","from":"AgenticPipelineIngestor","to":"AuthSystem"}
{"type":"relation","relationType":"contains","from":"AgenticPipelineIngestor","to":"AuditAndLineage"}
{"type":"relation","to":"Observability","relationType":"contains","from":"AgenticPipelineIngestor"}
{"type":"relation","from":"AgenticPipelineIngestor","to":"ConfigSettings","relationType":"contains"}
{"type":"relation","from":"AgenticPipelineIngestor","to":"DBModels","relationType":"contains"}
{"type":"relation","relationType":"contains","from":"AgenticPipelineIngestor","to":"APILayer"}
{"type":"relation","from":"AgenticPipelineIngestor","to":"TestSuite","relationType":"contains"}
{"type":"relation","from":"AgenticPipelineIngestor","to":"WorkerSystem","relationType":"contains"}
{"type":"relation","to":"DeploymentConfig","relationType":"contains","from":"AgenticPipelineIngestor"}
{"type":"relation","relationType":"follows","from":"AgenticPipelineIngestor","to":"ImplementationPhases"}
{"type":"relation","to":"7StagePipeline","relationType":"orchestrates","from":"OrchestrationEngine"}
{"type":"relation","relationType":"uses","from":"OrchestrationEngine","to":"PluginSystem"}
{"type":"relation","from":"OrchestrationEngine","to":"LLMProvider","relationType":"uses"}
{"type":"relation","from":"OrchestrationEngine","to":"CoreAdditionalModules","relationType":"uses"}
{"type":"relation","from":"7StagePipeline","to":"AgenticDecisionEngine","relationType":"uses"}
{"type":"relation","from":"7StagePipeline","to":"PluginSystem","relationType":"uses"}
{"type":"relation","relationType":"uses","from":"7StagePipeline","to":"LLMProvider"}
{"type":"relation","relationType":"instrumented_by","from":"7StagePipeline","to":"Observability"}
{"type":"relation","to":"LLMProvider","relationType":"depends_on","from":"AgenticDecisionEngine"}
{"type":"relation","from":"APILayer","to":"OrchestrationEngine","relationType":"delegates_to"}
{"type":"relation","to":"AuthSystem","relationType":"protected_by","from":"APILayer"}
{"type":"relation","from":"WorkerSystem","to":"OrchestrationEngine","relationType":"uses"}
{"type":"relation","to":"PluginSystem","relationType":"uses","from":"WorkerSystem"}